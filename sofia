#!/usr/bin/env bash

#Sofia's Version
if [ "$1" == "version" ] || [ "$1" == "v" ]; then
  echo 'version 0.1.6'
  exit
fi

#Sofia's help module
if [ "$1" == "help" ] || [ "$1" == "h" ]; then
  echo "% Sofia's Help Module %"
  echo "For creating a new project: sofia <project_name>"
  echo "For creating a new angular project: sofia <project_name> angular"
  echo "For version: sofia version or sofia v"
  echo "Installed packages: "
  echo "* jQuery (CDN)"
  echo "* Skeleton"
  echo "* Normalize"
  echo "* Gulp | gulp-sass | gulp-watch | gulp-plumber"
  exit
fi

#Sofia's Update Module
if [ "$1" == "update" ]; then
  echo "Updating!"
  cd
  sudo rm -rf ~/.sofia
  curl -L https://raw.githubusercontent.com/oelizondo/Sofia/master/install.sh | sh
  exit
fi

if [ "$1" == "run" ]; then
  cp -R assets build && cd build
  python -m SimpleHTTPServer
fi

#Install bower dependencies
function install_bower {
  bower install skeleton-css
}

#Template for angular apps
function angular_template {
  cd js

  if [ "$1" == "angular" ]; then

    mkdir controllers routes directives

    curl https://gist.githubusercontent.com/oelizondo/a19a267a1846cc3739af/raw/9d38633d188f3fc18080bdb9ef096e21e8060284/app.js -o app.js

    cd ..

    mkdir views

    rm index.html

    curl https://gist.githubusercontent.com/oelizondo/d8b7bbb34739d40197f0/raw/9437b0a2956695bb608e377a17e9968d4739d533/index.html -o index.html

  elif [ "$1" == "backbone" ]; then

    mkdir models routes views helpers templates vendor

    curl https://gist.githubusercontent.com/oelizondo/353ddfe711cd26c52930/raw/09ed1510ab5fa5304bace1e828ac48d414292e3b/backbone.js -o app.js

    cd ..

    rm index.html

    curl https://gist.githubusercontent.com/oelizondo/109e602537d6565d9e38/raw/2d74179f34b1fb5a3ea299dca535113b86b470c2/backbone.html -o index.html

  else

    curl https://gist.githubusercontent.com/oelizondo/da75a61ab577e37b6241/raw/f1552e41ade0b506dc38180fb44e5d81a86f7ef1/main.js -o main.js

    cd ..

  fi

}

#Starts a new Sofia Project
if [ "$1" == "new" ]; then

  echo 'Welcome to Sofia'

  bower=$(which bower)

  node=$(which node)

  nodejs=$(which nodejs)

  if [ ! -z $nodejs ] || [ ! -z $node ]; then

    if [ "$3" == "landing" ]; then
      git clone https://github.com/oelizondo/sofia_template_1.git
      cp -R sofia_template_1 $2
      rm -rf sofia_template_1
      exit
    fi

    mkdir $2 && cd $2

    echo 'Adding gitignore...'

    curl https://gist.githubusercontent.com/oelizondo/792469a52dae550750d5/raw/02ac633dc32632bfc18ea5e2dbe263cee1585f77/.gitignore -o .gitignore

    if [ -z $bower ]; then
      echo 'Do you want Sofia to install bower?(y/n)'
      read answertwo
      if [ "$answertwo" == 'y' ]; then
        echo 'Installing bower'
        sudo npm install --g bower
      fi
    fi

  # Starts project scaffold
  echo "Creating $2..."

    curl https://gist.githubusercontent.com/oelizondo/d8b7bbb34739d40197f0/raw/5b4a174e8b6d0813fbc858ab1a98e7296790b5e8/index.html -o index.html

    curl https://gist.githubusercontent.com/oelizondo/f51df1467385f25b6acf/raw/0050453064369806c8963ac489113d53ea08728b/gulpfile.js -o gulpfile.js

    mkdir assets js css

    cd assets

    mkdir images fonts videos

    cd ..

    cd css

    curl https://gist.githubusercontent.com/oelizondo/3ea02d6ee423fdb24e69/raw/c347f3c1cf11bac20e2abbb155d67fe76da8b6cd/style.scss -o style.scss

    touch _variables.scss

    touch _mixins.scss

    mkdir vendor && cd vendor

    curl https://gist.githubusercontent.com/oelizondo/c32a89f50dabd2520467/raw/78f3b4eb1a7c18db3459d25709a649a3a2d0001f/skeleton.css -o skeleton.css

    curl https://gist.githubusercontent.com/oelizondo/6fec4422313ad1ff49b1/raw/ca54d61066613a029970a5fc21b59c222e2cd2b3/normalize.css -o normalize.css

    cd ..
    cd ..

    angular_template $3

    curl https://gist.githubusercontent.com/oelizondo/768d3367f4eb253b0522/raw/cb1bc2950b2ba5dc1df122a69814a783a5097bd7/package.json -o package.json

    git init

    git add -A

    git commit -m "Initial commit, installs dependencies"

    git checkout -b dev

    echo 'Initial push is pending.'

    echo 'Sofia is done! Cd into your project and run gulp to start working! <3'

  else
    echo 'Node is not here, go ahead and install it to use Sofia.'
    echo 'Bye <3'
  fi

else

  echo "Command not found."

fi
